# Отчёт о сборе и очистке данных

## 1. Обзор

**Проект:** Оценка стоимости недвижимости
**Дата сбора:** 28-29 декабря 2024 г.
**Источники данных:**
- house.kg (Кыргызстан)
- krisha.kz (Казахстан)

---

## 2. Методология сбора данных

### 2.1 Инструменты
- **Язык:** Python 3.11
- **Библиотеки:** requests, BeautifulSoup4, pandas, tqdm
- **Метод:** Web scraping (парсинг HTML-страниц)

### 2.2 Архитектура парсера

```
┌─────────────────┐     ┌──────────────────┐     ┌─────────────────┐
│  Список страниц │ ──► │  Сбор URL        │ ──► │  Парсинг        │
│  (пагинация)    │     │  объявлений      │     │  деталей        │
└─────────────────┘     └──────────────────┘     └─────────────────┘
                                                          │
                                                          ▼
                                                 ┌─────────────────┐
                                                 │  CSV файл       │
                                                 │  (сохранение)   │
                                                 └─────────────────┘
```

### 2.3 Алгоритм сбора

1. **Определение количества страниц** — бинарный поиск для нахождения последней страницы с объявлениями
2. **Сбор URL объявлений** — последовательный обход всех страниц листинга
3. **Парсинг деталей** — извлечение данных с каждой страницы объявления
4. **Промежуточное сохранение** — каждые 50 записей для защиты от потери данных
5. **Автоматическое обнаружение полей** — новые поля добавляются динамически с префиксом `raw_`

### 2.4 Параметры сбора

| Параметр | Значение |
|----------|----------|
| Задержка между запросами | 1-3 секунды (случайная) |
| Таймаут соединения | 30 секунд |
| Повторные попытки | 3 |
| User-Agent | Mozilla/5.0 (Windows NT 10.0; Win64; x64) |

---

## 3. Собранные данные

### 3.1 Статистика по городам

| Город | Источник | Записей | Колонок | Статус |
|-------|----------|---------|---------|--------|
| Бишкек | house.kg | 9,952 | 42 | ✅ Завершён |
| Ош | house.kg | 30 | 37 | ✅ Завершён |
| Алматы | krisha.kz | 5,469 | 30 | ⏸️ Приостановлен |
| Астана | krisha.kz | 627 | 30 | ⏸️ Приостановлен |

### 3.2 Структура данных (Бишкек)

#### Основные поля
| Поле | Тип | Описание | Заполненность |
|------|-----|----------|---------------|
| url | string | Ссылка на объявление | 100% |
| parsed_at | datetime | Время парсинга | 100% |
| price_usd | float | Цена в USD | 100% |
| area | float | Общая площадь (м²) | 100% |
| rooms | float | Количество комнат | 96.5% |
| floor | int | Этаж | 98.2% |
| total_floors | int | Этажность дома | 98.2% |
| district | string | Район/микрорайон | 97.8% |
| latitude | float | Широта | 99.6% |
| longitude | float | Долгота | 99.6% |
| year_built | int | Год постройки | 85.3% |
| house_type | string | Тип дома | 99.7% |
| condition | string | Состояние | 92.3% |

#### Дополнительные поля
- living_area, kitchen_area — жилая и кухонная площадь
- heating, bathroom, balcony — характеристики квартиры
- parking, furniture, security — удобства
- documents, mortgage, installment — юридические аспекты

---

## 4. Очистка данных

### 4.1 Выявленные проблемы

| Проблема | Количество | % от данных | Решение |
|----------|------------|-------------|---------|
| Дубликаты (по URL) | 1,131 | 11.4% | Удалены |
| Не-Бишкек (Каракол, Чолпон-Ата) | 13 | 0.1% | Удалены |
| Цена/м² < $500 (ошибки) | 5 | 0.05% | Удалены |
| **Итого удалено** | **1,149** | **11.5%** | — |

### 4.2 Причины появления проблем

**Дубликаты:**
- Объявления обновлялись во время парсинга
- Режим resume добавлял записи к существующим
- Одно объявление на нескольких страницах листинга

**Географические выбросы:**
- Сайт house.kg включает объекты из других городов в общий поиск
- Фильтр по городу работает неточно

**Ценовые аномалии:**
- Ошибки при вводе данных продавцами
- Цены в другой валюте (сомы вместо долларов)

### 4.3 Результат очистки

| Метрика | До очистки | После очистки |
|---------|------------|---------------|
| Количество записей | 9,952 | 8,803 |
| Мин. цена | $1,350 | $23,500 |
| Медиана цены | $97,970 | $98,000 |
| Макс. цена | $1,500,000 | $1,500,000 |
| Мин. цена/м² | $29 | $510 |
| Медиана цена/м² | $1,558 | $1,557 |
| Макс. цена/м² | $8,514 | $8,514 |

---

## 5. Ограничения исследования

### 5.1 Ограничения данных

1. **Временной срез** — данные собраны за 1-2 дня, не отражают динамику рынка
2. **Только объявления о продаже** — не включены данные об аренде
3. **Заявленные цены** — фактические цены сделок могут отличаться
4. **Вторичный рынок + новостройки** — смешанные данные без чёткого разделения

### 5.2 Технические ограничения

1. **Блокировка krisha.kz** — сайт ограничивает частоту запросов, сбор данных Казахстана не завершён
2. **Динамический контент** — некоторые данные загружаются через JavaScript и могут быть пропущены
3. **Качество геокодирования** — координаты могут указывать на центр района, а не точный адрес

### 5.3 Ограничения выборки

1. **Только онлайн-объявления** — не учтены сделки без публикации в интернете
2. **Смещение к новостройкам** — застройщики активнее публикуют объявления
3. **Ценовое смещение** — дешёвые объекты продаются быстрее и реже попадают в выборку

---

## 6. Статистический профиль данных (Бишкек)

### 6.1 Распределение по комнатам

| Комнаты | Количество | % | Медиана цены |
|---------|------------|---|--------------|
| 1 | 2,594 | 26.1% | $65,000 |
| 2 | 3,415 | 34.3% | $94,500 |
| 3 | 2,896 | 29.1% | $135,000 |
| 4 | 773 | 7.8% | $239,000 |
| 5+ | 150 | 1.5% | $321,000 |

### 6.2 Распределение по типу дома

| Тип | Количество | % | Медиана цена/м² |
|-----|------------|---|-----------------|
| Монолит | 5,400 | 54.3% | $1,539 |
| Кирпич | 3,070 | 30.8% | $1,563 |
| Панель | 1,445 | 14.5% | $1,621 |

### 6.3 Топ-10 районов по количеству объявлений

| Район | Количество | Медиана цена/м² |
|-------|------------|-----------------|
| Магистраль | 2,294 | $1,642 |
| Горького-Алма-Атинская | 598 | $1,456 |
| АЮ Grand | 278 | $1,523 |
| Кок-Жар ж/м | 247 | $1,312 |
| с. Кок-Джар | 221 | $1,287 |

### 6.4 Корреляции с ценой

| Признак | Коэффициент корреляции |
|---------|------------------------|
| Площадь (area) | +0.872 |
| Количество комнат | +0.688 |
| Цена за м² | +0.459 |
| Этажность дома | +0.107 |
| Этаж | +0.079 |
| Год постройки | +0.069 |

---

## 7. Файлы данных

```
data/
├── raw/                                    # Исходные данные
│   ├── house_kg_bishkek_20251229_002031.csv   # Бишкек (9,952 записей)
│   ├── house_kg_osh_20251228_122734.csv       # Ош (30 записей)
│   ├── krisha_kz_intermediate_*.csv           # Алматы (промежуточные)
│   └── krisha_kz_astana_intermediate_*.csv    # Астана (промежуточные)
│
├── processed/                              # Очищенные данные
│   └── bishkek_clean.csv                      # Бишкек (8,803 записей)
│
└── *.log                                   # Логи парсинга
```

---

## 8. Воспроизводимость

### 8.1 Запуск парсера

```bash
# Бишкек
python src/scrapers/house_kg.py --city bishkek

# С возобновлением после прерывания
python src/scrapers/house_kg.py --city bishkek --resume

# Казахстан
python src/scrapers/krisha_kz.py --city almaty --max-pages 1600
```

### 8.2 Зависимости

```
requests>=2.28.0
beautifulsoup4>=4.11.0
pandas>=1.5.0
tqdm>=4.64.0
```

---

## 9. Этические аспекты

1. **Соблюдение robots.txt** — проверены правила сайтов
2. **Умеренная нагрузка** — задержки между запросами для снижения нагрузки на серверы
3. **Только публичные данные** — собраны только открытые объявления
4. **Анонимизация** — контактные данные продавцов не сохраняются

---

*Документ создан: 29 декабря 2024 г.*
