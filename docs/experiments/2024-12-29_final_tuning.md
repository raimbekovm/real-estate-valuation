# Финальный тюнинг с новыми признаками — 29 декабря 2024

## Изменения от предыдущего тюнинга
- **Признаков**: 25 → 42 (+17 новых)
- Добавлены: ceiling_height, балконы, паркинг, серии домов, производные признаки

## Методология
- **Оптимизатор**: Optuna с TPE sampler
- **Trials**: 50 на каждую модель
- **Валидация**: 5-Fold Cross-Validation
- **Метрика оптимизации**: MAE

## Результаты

### Сравнение с первым тюнингом (25 признаков → 42 признака)

| Модель | MAE (до) | MAE (после) | R² (до) | R² (после) | Улучшение |
|--------|----------|-------------|---------|------------|-----------|
| **XGBoost** | $129 ± $2 | **$126 ± $2** | 0.682 | **0.703** | -2.3% MAE |
| CatBoost | $130 ± $3 | $128 ± $2 | 0.686 | 0.698 | -1.5% MAE |
| LightGBM | $133 ± $3 | $131 ± $3 | 0.684 | **0.704** | -1.5% MAE |

### Лучшие гиперпараметры

#### XGBoost (победитель)
```python
{
    'n_estimators': 355,
    'max_depth': 10,
    'learning_rate': 0.051,
    'subsample': 0.642,
    'colsample_bytree': 0.650,
    'min_child_weight': 1,
    'reg_alpha': 0.126,
    'reg_lambda': 3.457
}
```

#### CatBoost
```python
{
    'iterations': 462,
    'depth': 9,
    'learning_rate': 0.106,
    'l2_leaf_reg': 2.39e-05,
    'bagging_temperature': 0.444,
    'random_strength': 2.13e-06
}
```

#### LightGBM
```python
{
    'n_estimators': 498,
    'max_depth': 10,
    'learning_rate': 0.080,
    'subsample': 0.641,
    'colsample_bytree': 0.733,
    'min_child_samples': 11,
    'reg_alpha': 0.0001,
    'reg_lambda': 4.138
}
```

## Итоговое сравнение (5-Fold CV)

| Модель | MAE | RMSE | R² |
|--------|-----|------|-----|
| **XGBoost** | **$126 ± $2** | $204 ± $21 | 0.703 ± 0.032 |
| CatBoost | $128 ± $2 | $206 ± $22 | 0.698 ± 0.040 |
| LightGBM | $131 ± $3 | $204 ± $21 | **0.704 ± 0.032** |

## Прогресс по этапам

| Этап | Признаков | Лучший MAE | R² | Модель |
|------|-----------|------------|-----|--------|
| Baseline | 14 | $142 | 0.605 | Random Forest |
| + POI | 25 | $145 | 0.600 | XGBoost |
| + Тюнинг | 25 | $129 | 0.682 | XGBoost |
| + Новые признаки | 42 | $141 | 0.616 | XGBoost |
| **+ Финальный тюнинг** | 42 | **$126** | **0.703** | **XGBoost** |

## Выводы

1. **XGBoost — лучшая модель по MAE** ($126/м²)
   - Улучшение на $16 от baseline ($142 → $126)
   - Улучшение на 11% (16/142)

2. **R² достиг 0.70**
   - Модель объясняет 70% вариации цен
   - Улучшение от 0.605 до 0.703 (+16%)

3. **Новые признаки дали эффект**
   - ceiling_height, is_elite, has_parking — важные предикторы

4. **Все модели сравнялись после тюнинга**
   - Разброс всего $5 ($126-131)

## Интерпретация

- **Медианная цена**: ~$1,560/м²
- **Ошибка лучшей модели**: $126/м² (8.1% от медианы)
- **Для квартиры 60м²**: ошибка ~$7,560 (при средней цене ~$94,000)

Ошибка менее 10% позволяет использовать модель для предварительной оценки недвижимости.
