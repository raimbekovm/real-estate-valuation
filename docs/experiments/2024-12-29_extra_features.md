# Дополнительные признаки — 29 декабря 2024

## Добавленные признаки (+13)

### Из существующих данных
| Признак | Источник | Заполнено |
|---------|----------|-----------|
| `has_red_book` | documents | 100% (56% реальных) |
| `has_tech_passport` | documents | 100% |
| `has_main_gas` | gas | 100% (35% реальных) |
| `has_gas` | gas | 100% |
| `has_furniture` | furniture | 100% (31% реальных) |
| `is_empty` | furniture | 100% |
| `has_parquet` | floor_type | 100% (22% реальных) |
| `has_laminate` | floor_type | 100% |

### Target encoding по районам
| Признак | Описание |
|---------|----------|
| `district_price_mean` | Средняя цена в районе |
| `district_price_smoothed` | Сглаженная средняя (для малых выборок) |

### Производные площади
| Признак | Формула | Заполнено |
|---------|---------|-----------|
| `living_area_ratio` | living_area / area | 16% |
| `kitchen_area_ratio` | kitchen_area / area | 13% |

### Категориальные
| Признак | Описание |
|---------|----------|
| `building_decade` | Декада постройки (1960s, 1970s...) |

## Результаты

### Baseline (без тюнинга)
| Модель | MAE (42 признака) | MAE (55 признаков) |
|--------|-------------------|---------------------|
| Random Forest | $142 | **$138** |
| XGBoost | $141 | **$139** |
| LightGBM | $143 | $143 |

### После тюнинга
| Модель | MAE (42 признака) | MAE (55 признаков) |
|--------|-------------------|---------------------|
| XGBoost | **$126** | $126 |
| CatBoost | $128 | $129 |
| LightGBM | $131 | $132 |

## Важность новых признаков

### CatBoost (baseline)
| Ранг | Признак | Важность |
|------|---------|----------|
| **2** | district_price_mean | **10.98%** |
| **4** | district_price_smoothed | **7.33%** |

## Выводы

1. **District encoding — сильный предиктор**
   - 2-й по важности после condition
   - Суммарно 18% важности

2. **MAE не улучшился после тюнинга**
   - Модель достигла "потолка" $126/м²
   - Новые признаки дают информацию, которую модель уже извлекала из координат

3. **Для интерпретации полезно**
   - district_price_mean понятнее чем latitude/longitude
   - Можно объяснить клиенту: "средняя цена в вашем районе $X"

4. **Итоговое количество признаков**: 55 (38 numeric + 5 categorical)

## Прогресс проекта

| Этап | Признаков | MAE | R² |
|------|-----------|-----|-----|
| Baseline | 14 | $142 | 0.605 |
| + POI | 25 | $145 | 0.600 |
| + Тюнинг | 25 | $129 | 0.682 |
| + Новые признаки | 42 | $126 | 0.703 |
| + Extra признаки | 55 | $126 | 0.690 |

**Лучший результат: XGBoost с MAE $126/м² (8.1% от медианы)**
