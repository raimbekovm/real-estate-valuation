# Отчёт о сборе и анализе данных: Астана (krisha.kz)

## 1. Обзор

**Город:** Астана, Казахстан
**Источник данных:** krisha.kz
**Дата сбора:** 5-6 января 2025 г.
**Метод сбора:** Selenium WebDriver (headless Chrome)

---

## 2. Процесс сбора данных

### 2.1 Этапы парсинга

1. **Сбор URL объявлений** — обход 1000 страниц листинга
2. **Парсинг деталей** — извлечение данных с каждой страницы объявления
3. **Промежуточное сохранение** — каждые 50 записей в CSV
4. **Сохранение в SQLite** — для отслеживания обработанных URL

### 2.2 Технические параметры

| Параметр | Значение |
|----------|----------|
| Браузер | Chrome 143 (headless) |
| Задержка между запросами | 2-4 секунды |
| Таймаут загрузки страницы | 30 секунд |
| Повторные попытки при ошибке | 2 |
| Время парсинга | ~38 часов |

### 2.3 Особенности krisha.kz

- Требуется Selenium из-за JavaScript-рендеринга
- Агрессивная защита от ботов (блокировка IP)
- Координаты загружаются динамически через API карт
- Некоторые поля доступны только после полной загрузки страницы

---

## 3. Собранные данные

### 3.1 Общая статистика

| Метрика | Значение |
|---------|----------|
| Всего записей | 22,645 |
| Колонок | 37 |
| Период данных | январь 2025 |
| Охват рынка | ~90% активных объявлений |

### 3.2 Структура данных

#### Основные поля (100% заполненность)

| Поле | Тип | Описание |
|------|-----|----------|
| url | string | Ссылка на объявление |
| parsed_at | datetime | Время парсинга |
| listing_id | int | Уникальный ID объявления |
| source | string | Источник (krisha.kz) |
| city | string | Город (Астана) |
| price_kzt | float | Цена в тенге |
| price_usd | float | Цена в долларах США |
| price_per_m2_kzt | float | Цена за м² в тенге |
| rooms | int | Количество комнат |
| area | float | Общая площадь (м²) |
| latitude | float | Широта (координаты) |
| longitude | float | Долгота (координаты) |
| year_built | int | Год постройки |

#### Поля с высокой заполненностью (90-99%)

| Поле | Тип | Описание | Заполненность |
|------|-----|----------|---------------|
| district | string | Район города | 95.8% |
| floor | int | Этаж квартиры | 94.7% |
| total_floors | int | Этажность дома | 94.7% |
| house_type | string | Тип дома (монолит/кирпич/панель) | 91.4% |
| address | string | Адрес | 100% |

#### Дополнительные поля

| Поле | Тип | Описание | Заполненность |
|------|-----|----------|---------------|
| condition | string | Состояние квартиры | 40.9% |
| bathroom | string | Тип санузла | 61.4% |
| balcony | string | Наличие балкона | 51.3% |
| balcony_glazed | string | Остекление балкона | 5.4% |
| parking | string | Парковка | 68.7% |
| furniture | string | Мебель | 49.5% |
| floor_type | string | Тип пола | 7.2% |
| ceiling_height | string | Высота потолков | 23.1% |
| entrance_door | string | Входная дверь | 5.8% |
| security | string | Охрана/безопасность | 12.3% |
| has_phone | bool | Наличие телефона | 2.1% |
| internet | string | Интернет | 4.5% |
| living_area | float | Жилая площадь | 8.3% |
| kitchen_area | float | Площадь кухни | 7.9% |
| former_dormitory | bool | Бывшее общежитие | 0.8% |
| exchange_possible | bool | Возможен обмен | 1.2% |

#### Сырые поля (raw_*)

| Поле | Описание |
|------|----------|
| raw_жилой_комплекс | Название ЖК |
| raw_состояние_квартиры | Состояние (оригинал) |
| raw_интернет | Интернет (оригинал) |

---

## 4. Очистка данных

### 4.1 Выявленные проблемы

#### Дубликаты

| Тип | Количество | % от данных |
|-----|------------|-------------|
| По listing_id | 4,261 | 18.8% |
| По URL | 0 | 0% |

**Причины:**
- Объявления обновлялись во время многодневного парсинга
- Режим resume добавлял записи при перезапусках после блокировок
- Один listing_id появлялся на разных страницах поисковой выдачи

#### Географические выбросы

| Проблема | Количество | Координаты |
|----------|------------|------------|
| Координаты Алматы | 28 | lat ~43.3 |
| Координаты за пределами города | 8 | lat <51.0 или >51.5 |
| **Итого** | **36** | — |

**Допустимые границы Астаны:**
- Широта: 51.0 — 51.5
- Долгота: 71.2 — 71.8

#### Ценовые аномалии

| Проблема | Количество | Примеры |
|----------|------------|---------|
| Цена/м² < 200,000 ₸ | 9 | 95k-170k ₸/м² |
| Цена/м² > 2,000,000 ₸ | 6 | до 4.3M ₸/м² |
| **Итого** | **15** | — |

**Причины:**
- Ошибки при вводе данных продавцами
- Коммерческая недвижимость в жилом разделе
- Элитные пентхаусы (статистические выбросы)

#### Аномалии площади

| Проблема | Количество |
|----------|------------|
| Площадь < 15 м² | 27 |
| Площадь > 400 м² | 13 |
| **Итого** | **40** |

### 4.2 Применённые фильтры

```python
# 1. Удаление дубликатов
df = df.drop_duplicates(subset='listing_id', keep='first')

# 2. Фильтр по координатам (только Астана)
df = df[(df['latitude'] >= 51.0) & (df['latitude'] <= 51.5) &
        (df['longitude'] >= 71.2) & (df['longitude'] <= 71.8)]

# 3. Фильтр по цене за м²
df = df[(df['price_per_m2_kzt'] >= 200_000) &
        (df['price_per_m2_kzt'] <= 2_000_000)]

# 4. Фильтр по площади
df = df[(df['area'] >= 15) & (df['area'] <= 400)]

# 5. Корректировка года постройки
df.loc[df['year_built'] > 2026, 'year_built'] = 2026
```

### 4.3 Результаты очистки

| Этап | Удалено | Осталось |
|------|---------|----------|
| Исходные данные | — | 22,645 |
| После удаления дубликатов | 4,261 | 18,384 |
| После фильтра координат | 36 | 18,348 |
| После фильтра цены | 15 | 18,333 |
| После фильтра площади | 40 | 18,293 |
| **Итого удалено** | **4,352 (19.2%)** | **18,293** |

### 4.4 Сравнение до/после

| Метрика | До очистки | После очистки |
|---------|------------|---------------|
| Количество записей | 22,645 | 18,293 |
| Мин. цена | 3.99 млн ₸ | 4.8 млн ₸ |
| Медиана цены | 36.0 млн ₸ | 36.0 млн ₸ |
| Макс. цена | 1,500 млн ₸ | 490 млн ₸ |
| Мин. цена/м² | 50,000 ₸ | 209,726 ₸ |
| Медиана цена/м² | 590,277 ₸ | 590,909 ₸ |
| Макс. цена/м² | 4,285,714 ₸ | 2,000,000 ₸ |

---

## 5. Статистический анализ (после очистки)

### 5.1 Ценовая статистика

#### Общая статистика цен

| Метрика | Цена (млн ₸) | Цена/м² (₸) |
|---------|--------------|-------------|
| Минимум | 4.8 | 209,726 |
| 25-й перцентиль | 24.0 | 480,000 |
| Медиана | 36.0 | 590,909 |
| Среднее | 47.0 | 627,000 |
| 75-й перцентиль | 55.0 | 740,000 |
| Максимум | 490.0 | 2,000,000 |

#### Цена по количеству комнат

| Комнаты | Кол-во | % | Медиана цены | Медиана ₸/м² |
|---------|--------|---|--------------|--------------|
| 1 | 4,319 | 23.6% | 22.5 млн ₸ | 575,000 ₸ |
| 2 | 6,570 | 35.9% | 33.5 млн ₸ | 592,940 ₸ |
| 3 | 5,284 | 28.9% | 50.0 млн ₸ | 569,230 ₸ |
| 4 | 1,725 | 9.4% | 85.0 млн ₸ | 683,544 ₸ |
| 5+ | 395 | 2.2% | 138.0 млн ₸ | 748,480 ₸ |

#### Цена по районам

| Район | Кол-во | % | Медиана ₸/м² | Характеристика |
|-------|--------|---|--------------|----------------|
| Есильский | 5,100 | 27.9% | 707,327 ₸ | Деловой центр, Левый берег |
| Нура | 4,091 | 22.4% | 664,644 ₸ | Новые районы |
| Алматы | 3,860 | 21.1% | 511,111 ₸ | Старый центр |
| Сарыарка | 2,087 | 11.4% | 470,404 ₸ | Спальные районы |
| Сарайшык | 1,475 | 8.1% | 571,584 ₸ | Развивающийся район |
| Байконур | 910 | 5.0% | 453,047 ₸ | Окраина |

#### Цена по типу дома

| Тип дома | Кол-во | % | Медиана ₸/м² | Разница |
|----------|--------|---|--------------|---------|
| Монолитный | 9,450 | 51.7% | 648,648 ₸ | +18.2% |
| Кирпичный | 6,755 | 36.9% | 548,609 ₸ | базовый |
| Иной | 258 | 1.4% | 510,067 ₸ | -7.0% |
| Панельный | 711 | 3.9% | 441,666 ₸ | -19.5% |

#### Цена по году постройки

| Период | Кол-во | % | Медиана ₸/м² | Тренд |
|--------|--------|---|--------------|-------|
| до 1990 | 956 | 5.2% | 417,721 ₸ | — |
| 1990-2000 | 293 | 1.6% | 432,500 ₸ | +3.5% |
| 2000-2010 | 2,362 | 12.9% | 480,549 ₸ | +11.1% |
| 2010-2015 | 1,896 | 10.4% | 514,800 ₸ | +7.1% |
| 2015-2020 | 3,718 | 20.3% | 615,728 ₸ | +19.6% |
| 2020-2025 | 7,970 | 43.6% | 680,000 ₸ | +10.4% |
| 2025+ | 1,098 | 6.0% | 613,157 ₸ | -9.8% |

### 5.2 Характеристики квартир

#### Площадь

| Метрика | Значение |
|---------|----------|
| Минимум | 15.0 м² |
| Медиана | 63.0 м² |
| Среднее | 72.5 м² |
| Максимум | 400.0 м² |

#### Распределение по площади

| Диапазон | Кол-во | % |
|----------|--------|---|
| 15-40 м² | 3,223 | 17.6% |
| 40-60 м² | 5,291 | 28.9% |
| 60-80 м² | 3,993 | 21.8% |
| 80-100 м² | 2,558 | 14.0% |
| 100-150 м² | 2,440 | 13.3% |
| 150+ м² | 788 | 4.3% |

#### Этажность

| Метрика | Этаж квартиры | Этажность дома |
|---------|---------------|----------------|
| Минимум | 1 | 2 |
| Медиана | 6 | 10 |
| Максимум | 41 | 43 |

#### Влияние этажа на цену

| Тип этажа | Кол-во | Медиана ₸/м² | Разница |
|-----------|--------|--------------|---------|
| Первый | 811 | 493,197 ₸ | -18.3% |
| Средний | 15,518 | 603,550 ₸ | базовый |
| Последний | 1,964 | 532,786 ₸ | -11.7% |

### 5.3 Корреляционный анализ

#### Корреляции с ценой за м²

| Признак | Корреляция | Интерпретация |
|---------|------------|---------------|
| Год постройки | +0.387 | Новые дома дороже |
| Этажность дома | +0.192 | Высотки дороже |
| Площадь | +0.187 | Большие квартиры дороже за м² |
| Комнаты | +0.165 | Многокомнатные дороже за м² |
| Этаж | +0.118 | Выше этаж — дороже |
| Широта | -0.058 | Слабая связь с расположением |

### 5.4 Дополнительные характеристики

#### Состояние квартиры

| Состояние | Кол-во | % |
|-----------|--------|---|
| Свежий ремонт | 4,786 | 21.1% |
| Не новый, но аккуратный | 2,519 | 11.1% |
| Черновая отделка | 1,544 | 6.8% |
| Требует ремонта | 318 | 1.4% |
| Свободная планировка | 107 | 0.5% |
| Не указано | 9,019 | 49.3% |

#### Санузел

| Тип | Кол-во | % |
|-----|--------|---|
| Совмещённый | 7,115 | 38.9% |
| 2 и более с/у | 4,288 | 23.4% |
| Раздельный | 2,505 | 13.7% |
| Не указано | 4,385 | 24.0% |

#### Балкон

| Тип | Кол-во | % |
|-----|--------|---|
| Лоджия | 5,391 | 29.5% |
| Балкон | 4,157 | 22.7% |
| Несколько | 1,249 | 6.8% |
| Балкон и лоджия | 816 | 4.5% |
| Не указано | 6,680 | 36.5% |

#### Парковка

| Тип | Кол-во | % |
|-----|--------|---|
| Паркинг | 14,276 | 78.0% |
| Охраняемая стоянка | 1,268 | 6.9% |
| Гараж | 23 | 0.1% |
| Не указано | 2,726 | 14.9% |

#### Мебель

| Наличие | Кол-во | % |
|---------|--------|---|
| Полностью | 7,620 | 41.7% |
| Частично | 2,643 | 14.4% |
| Без мебели | 933 | 5.1% |
| Не указано | 7,097 | 38.8% |

---

## 6. Выводы и рекомендации

### 6.1 Ключевые выводы

1. **Рынок растущий** — 49.6% квартир построены после 2020 года
2. **Монолит доминирует** — 51.7% жилого фонда, премия +18% к кирпичу
3. **Левый берег дороже** — Есильский район на 55% дороже Байконура
4. **Средние этажи в цене** — первый и последний этажи со скидкой 12-18%
5. **Год постройки — главный фактор** — корреляция +0.39 с ценой/м²

### 6.2 Рекомендации для моделирования

1. **Обязательные признаки:**
   - Координаты (latitude, longitude)
   - Год постройки
   - Тип дома
   - Площадь
   - Этаж / этажность

2. **Важные категориальные:**
   - Район
   - Состояние квартиры
   - Наличие парковки

3. **Feature engineering:**
   - is_first_floor, is_last_floor
   - floor_ratio = floor / total_floors
   - building_age = 2025 - year_built
   - is_new_building = year_built >= 2020

### 6.3 Ограничения данных

1. **Заявленные цены** — реальные цены сделок могут быть на 5-15% ниже
2. **Временной срез** — данные за 1-2 дня, не отражают сезонность
3. **Смещение выборки** — активные объявления, дешёвые объекты продаются быстрее

---

## 7. Файлы данных

```
data/
├── raw/
│   └── krisha_kz_astana_intermediate_20260106_001550.csv  # Исходные (22,645)
│
└── processed/
    └── astana_clean.csv                                    # Очищенные (18,293)
```

---

## 8. Воспроизводимость

### Запуск парсера

```bash
# Сбор URL (1000 страниц)
python src/scrapers/krisha_kz.py --city astana --selenium --collect-only --max-pages 1000

# Парсинг объявлений
python src/scrapers/krisha_kz.py --city astana --selenium --resume --delay-min 2 --delay-max 4
```

### Очистка данных

```python
import pandas as pd

df = pd.read_csv('data/raw/krisha_kz_astana_intermediate_20260106_001550.csv')

# Удаление дубликатов
df = df.drop_duplicates(subset='listing_id', keep='first')

# Фильтр координат (Астана)
df = df[(df['latitude'] >= 51.0) & (df['latitude'] <= 51.5) &
        (df['longitude'] >= 71.2) & (df['longitude'] <= 71.8)]

# Фильтр цены
df = df[(df['price_per_m2_kzt'] >= 200_000) & (df['price_per_m2_kzt'] <= 2_000_000)]

# Фильтр площади
df = df[(df['area'] >= 15) & (df['area'] <= 400)]

df.to_csv('data/processed/astana_clean.csv', index=False)
```

---

*Документ создан: 6 января 2025 г.*
